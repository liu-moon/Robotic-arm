

# 一.机械臂运动学控制导引

## 1.概要

本文了解了 **机械臂的基础概念**，什么是 **机械臂的运动学**，以及这套机械臂运送学控制课程的 **教学思路**。

最后还给出了学习机械臂运动学控制所需的 **预备知识**。

## 2.机械臂的基础概念

### 2.1机械臂的定义

![机械臂定义](/pic/机械臂定义.png)

机械臂就是机械手臂，是工业机器人领域里面数目最多的一种机器人类型。机械臂可以模仿人的手臂，完成特定的功能，在工业的流水线上有广泛的应用。

更多关于机械臂的介绍见: [机械臂-百度百科](https://baike.baidu.com/item/%E6%9C%BA%E6%A2%B0%E8%87%82/2178090?fr=aladdin)



### 2.2机械臂的结构

机械臂主体由 **连杆Link**和 **关节Joint**构成。

![机械臂定义](/pic/机械臂的结构.png)

关节就是机械臂中连杆与连杆之间可以运功的部件，关节与关节间的连杆不可发生形变，属于刚体。

![机械臂定义](/pic/关节.png)

最基本的两种**关节Joint**，一种是**旋转关节 Revolute Joint**，另外一种是**滑动关节Sliding Joint**。

![机械臂定义](/pic/执行器.png)

机械臂设计出来是为了帮人做事的，所以在机械臂的末端，都会有一个执行器，例如**夹子**，或者是**吸头**，这些都统称为**末端执行器 End Effector**。

连接末端执行器与机械臂连杆的末端关节，称之为**腕关节 Wrist Joint**，类似人的手腕，只不过有的机器人腕关节是可以动的，有的是**固定Fixed**的。



### 2.3机械臂的自由度

一般说机械臂的自由度，说的都是机械手臂主体的自由度，不包括**末端执行器**。

机械臂的自由度，等于机械臂活动关节个数。

![机械臂定义](/pic/自由度.png)

例如上图的机械臂，一共有4个关节，Joint1,Joint2,Joint3是活动关节，而腕关节Joint4是固定的，并不能旋转。所以上图的这个机械臂总共有3个自由度，简写为3DoF。**DoF是Degree Of Freedom**的英文简称。



## 3.机械臂的运动学

如果你想控制机械臂到达空间中一个特定的点，需要求出舵机旋转角度，就需要学习机器人运动学的知识。

**机器人运动学 robot kinematics**包括**正向运动学 Forward Kinematics**和**逆向运动学 Inverse Kinematics**。



### 3.1正向运动学

**正向运动学**解决的问题是，已知每个舵机旋转的角度，求解出末端执行器在坐标系下的**位置 Position**和**姿态Pose**(合称 位姿)。一般来讲，正向运动学求解比较容易而且解也是唯一的，一组舵机的角度，对应着唯一的一个位姿。

![机械臂定义](/pic/正向运动.png)

正向运动学解就是一个已知关节角度，进而推导末端执行器位姿的过程。

![机械臂定义](/pic/公式1.png)



### 3.2逆向运动学

而逆向运动学解就困难的多，**逆向运动学**解决的问题是，已知末端执行器的位姿，让你求解出来各个关节的角度。

![机械臂定义](/pic/逆向运动学.png)

逆向运动学求解往往存在多个解。下面举一个用一个末端执行的位置求解出来两个坐标的例子：

![机械臂定义](/pic/逆向运动例.png)

在多个关节的运动学求解过程中考虑到**关节角度约束**的问题，可以排除一部分解。



## 4.教学思路

这节课的目标就是让你可以运用**机械臂运动学**的知识，用机械臂对物块进行**定点抓取**。

机械臂运动学求解核心就是理解**空间变换**，从同一个坐标系向量的旋转与平移，再到同一个点在不同坐标系下的表示**(映射 Mapping)**，研究坐标系与坐标系下的变换关系。

直接从三维入手会比较复杂，而且需要一定的空间想象能力。所以在课程设计上，先讲**2D平面坐标系下的变换**，然后逐渐过渡到**3D立体空间下的变换**。



1. 要学习2D平面下**空间变换**的基础知识。列举**小乌龟**的例子，分析小乌龟的运动，获	取小乌龟相对于全局坐		标系的位姿变换。

   ![机械臂定义](/pic/小乌龟.png)

2. 开始分析2D坐标系下的机械臂模型，对其进行建模以及仿真。学习**平面2自由度机械臂的正向运动学以及逆向运动学求解**。

   ![机械臂定义](/pic/建模.png)

3. 将研究范围提高一个维度，分析**三维空间**下的坐标系与坐标系之间的变换，学会求解点在不同坐标系下的映射。

   ![机械臂定义](/pic/三维.png)

   ![机械臂定义](/pic/三轴.png)

4. 学习机械臂建模的经典方法**DH模型**。分析DH模型的推导过程，通过实际的例子分析关节与关节之间的变换。

   ![机械臂定义](/pic/DH.png)

5. 以MK1开源机械臂作为**3自由度机械臂**的实例，分析其关节结构，建立MK1的DH模型。并提供MK1开源机械臂的资料汇总，学生可以自行3D打印制作自己的低成本3自由度机械臂。

   ![机械臂定义](/pic/机械臂.png)

6. 对三自由度机械臂进行**正向运动学推导**，还有**逆向运动学求解**，使用python进行机械臂的模拟仿真，拖到滑动条观察给关节设置不同的旋转角度对应的末端执行器的位姿。

   ![机械臂定义](/pic/仿真.png)

7. 对MK1的**机械结构**进行分析，讲解如何在关节角度与舵机旋转角度之间建立关系。并用**MicroPython**实现对机械臂的控制，使用实体的**MK1机械臂**进行**逆向运动学测试**。

   ![机械臂定义](/pic/测试.png)

8. 分析机械臂物块抓取的一般步骤，教你怎么从**末端执行器**的位置推导出**腕关节**的位置。

   实现用机械臂进行物块抓取的动作。

   ![机械臂定义](/pic/执行.png)

## 5.预备知识

### 5.1数学基础

学习机械臂的运动学你需要有一定的数学基础，一是需要掌握**三角函数**(sin,cos,tan...)的知识。二是需要掌握**线性代数**基础(矩阵乘法，矩阵转置，正交矩阵等等)，因为运动学里面的变换都是通过矩阵运算实现的。

### 5.2Python编程基础+科学计算基础

我们的课程里非常注重**代码实战**，概念很抽象，只有用代码验证了实现了才能证明你学会了。

在学习课程概念的时候，需要使用**Python**进行：

- 交互式编程
- 矩阵运算Numpy，在1Z实验室的教学网站上有免费的Numpy基础入门[numpy基础1zlab.com](http://www.1zlab.com/wiki/python-opencv-tutorial/numpy-tutorial/)
- 可视化Matplotlib
- 机械臂模拟仿真(Numpy+Matplotlib)



### 5.3硬件控制基础

至少会一种单片机语言，推荐使用MicroPython-ESP32来做，Arduino，C51，STM32亦可。

硬件控制部分不做强制要求，看个人爱好。



# 二.机器人的坐标系与位姿

## 1.概要

本文介绍了笛卡尔坐标系的分类，还有在笛卡尔坐标系中经常会被用到的右手坐标系。

以及机器人在平面直角坐标系与空间直角坐标系下的位姿描述。



## 2.笛卡尔坐标系

在空间中有两条或三条**数轴**相交于原点。

两条数轴构成了一个**平面**，三条数轴构成了一个立体的空间。如果数轴上的刻度(度量单位)一致，那么形成的这个坐标系就叫做**笛卡尔坐标系**。

**笛卡尔坐标系**的英文叫做**Cartesian Coordinate System**

![机械臂定义](/pic/笛卡尔.png)

根据数轴之间是否垂直，笛卡尔坐标系又可以分为**笛卡尔直角坐标系**和**笛卡尔斜角坐标系**。其中笛卡尔直角坐标系我们用的比较多。

![机械臂定义](/pic/斜角.png)

根据维度(数轴个数)的不同，笛卡尔直角坐标系又可以分为**二维直角坐标系**和**三维直角坐标系**。

![机械臂定义](/pic/高维.png)

另外，不管是二维的还是三维的都存在一个问题，如果我修改坐标轴的正方向，那此时点在坐标系中的位置就会是一个相反的值。根据轴与轴之间正方向关系，笛卡尔坐标系，又分为**左手直角坐标系**和**右手直角坐标系**。

在空间直角坐标系中，让右手拇指指向x轴的正方向，食指指向y轴的正方向，如果中指能指向z轴的正方向，则称这个坐标系为**右手直角坐标系**。反之则是**左手直角坐标系**。

下图为右手坐标系的示意图：

![机械臂定义](/pic/右手.png)

在数学中则通常使用右手坐标系，我们研究机器人在空间中的关系时，使用的也是**右手坐标系**。



## 3.位姿

**位姿 Pose**是两个属性**位置 Position**和**旋转 Orientation**的叠加。

说到**位置 Position**,大家比较熟悉，在二维直角坐标系下，(x,y)两个值可以确定一个点在平面中的位置。在三维的直角坐标系下，(x,y,z)三个值可以确定一个点在立体空间中的位置。

对于一个机器人来讲，它并不能被看成一个点，它有体积，在同一个点上可以有不用的**朝向**或者是说**倾角**，而**旋转 Orientation**就是用于刻画机器人在当前坐标系下在各个轴上面的**倾角**。

接下来，我们来分析一下在二维和三维下的位姿。



### 3.1二维直角坐标系下的位姿

拿小乌龟举例，小乌龟在平面上运动。将小乌龟的头部所指的方向，作为小乌龟的朝向。在地面上建立一个二维直角坐标系。

![机械臂定义](/pic/位姿.png)

图中，小乌龟的**位置Position**都相等。

![机械臂定义](/pic/公式2.png)

但是小乌龟的**旋转**各不相同，使用*θ*来表示小乌龟的旋转。



将x转向y轴方向作为角度正方向，*θ*的角度取值范围为[-180，180]，在工程领域习惯使用**弧度 Radian**来表示角度，所以转换为弧度*θ*的取值范围如下：

​											$$-\pi \leq \theta \leq \pi ​$$						   (3)



### 3.2三维直角坐标系下的位姿

三维坐标系下，位置描述依然简单，但是描述旋转就有些麻烦了。

我们引入一种方法叫做**RPY角 (Roll,Pitch,Yaw)**描述法，也叫**固定XYZ轴角 (X-Y-Z Fixed Angles)**描述法

在工程领域里面，飞机模型最适合拿来举例子。



机身所在直线为**Y轴**，机头方向为Y轴的正方向。

飞机竖直方向为**Z轴**，向上为Z轴的正方向。

机翼所在的直线为**X轴**，根据右手定则可知右侧机翼为X轴的正方向。

![机械臂定义](/pic/飞机.png)

> [图片来源](https://www.researchgate.net/publication/266605475_Projeto_de_software_para_simulacao_de_voo_empregando_a_ferramenta_Analytice_II?_sg=zlLDXSEn0GRIIWRTAMejDW2KQD6zzGGHmX9sXkrEVsQQJxzdkAEYh8YcOBaWeyJKrBUU7hnG8qUTP-Fel0EN1JGQ0ds5iAaOOw)



按照先后顺序**依次**进行：

- **步骤一**：飞机按照参考坐标系的X轴旋转**Pitch**角度，Picth的中文叫做**俯仰角**。

![机械臂定义](/pic/俯仰.png)

- **步骤二**：然后飞机按照参考坐标系的Y轴旋转**Roll**角度，Roll中文名字叫做**横滚角**。

![机械臂定义](/pic/横滚.png)

- **步骤三**：飞机按照参考坐标系的Z轴旋转**Yaw / Heading**角度，中文名字叫做**偏航角/航向角**

![机械臂定义](/pic/偏航.png)

| 英文  |  中文  | 参考轴 |  别名  |
| :---: | :----: | :----: | :----: |
| Picth | 俯仰角 |   X    |        |
| Roll  | 横滚角 |   Y    |        |
|  Yaw  | 偏航角 |   Z    | 航向角 |

所以队形在3D空间下的Frame就应该是
									$$Frame = (x,y,z,pitch,roll,yaw)$$							(4)

在后续的**空间坐标系下向量的平移与旋转**课程里会详细讲解。






